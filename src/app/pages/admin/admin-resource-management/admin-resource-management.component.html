<div class="admin-page-container">
  <!-- Page Header -->
  <header class="admin-page-header">
    <div class="admin-header-content">
      <div class="galley-header">
        <h1 class="admin-page-title">üìö Galley Resource Management</h1>
        <p class="admin-page-subtitle">Upload and manage resources for the Stocking the Galley section</p>
      </div>
      <button
        class="btn-primary admin-create-btn"
        (click)="toggleForm()"
        [disabled]="loading()">
        @if (showForm()) {
          ‚ùå Cancel
        } @else {
          üì§ Upload Resource
        }
      </button>
    </div>
  </header>

  <!-- Alert Messages -->
  @if (error()) {
    <div class="alert alert-error">
      <span class="alert-icon">‚ö†Ô∏è</span>
      <span>{{ error() }}</span>
      <button class="alert-close" (click)="clearMessages()">‚úï</button>
    </div>
  }

  @if (success()) {
    <div class="alert alert-success">
      <span class="alert-icon">‚úÖ</span>
      <span>{{ success() }}</span>
      <button class="alert-close" (click)="clearMessages()">‚úï</button>
    </div>
  }

  <!-- Resource Upload Form -->
  @if (showForm()) {
    <div class="resource-form-container">
      <div class="form-card">
        <div class="form-header">
          <h2 class="form-title">
            @if (editingResource()) {
              ‚úèÔ∏è Edit Resource
            } @else {
              üì§ Upload New Resource
            }
          </h2>
        </div>

        <form [formGroup]="resourceForm" (ngSubmit)="submitResource()" class="resource-form">
          <div class="form-row">
            <div class="form-group">
              <label for="title" class="form-label">Resource Title *</label>
              <input
                id="title"
                type="text"
                formControlName="title"
                class="form-input"
                placeholder="Enter resource title">
              @if (resourceForm.get('title')?.invalid && resourceForm.get('title')?.touched) {
                <div class="form-error">
                  @if (resourceForm.get('title')?.errors?.['required']) {
                    Title is required
                  }
                  @if (resourceForm.get('title')?.errors?.['minlength']) {
                    Title must be at least 3 characters long
                  }
                </div>
              }
            </div>

            <div class="form-group">
              <label for="techTrack" class="form-label">Tech Track *</label>
              <select
                id="techTrack"
                formControlName="techTrack"
                class="form-select">
                <option value="">Select a track</option>
                @for (track of tracks(); track track.id) {
                  <option [value]="track.name">{{ track.icon }} {{ track.name }}</option>
                }
              </select>
              @if (resourceForm.get('techTrack')?.invalid && resourceForm.get('techTrack')?.touched) {
                <div class="form-error">Tech track is required</div>
              }
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="type" class="form-label">Content Type *</label>
              <select
                id="type"
                formControlName="type"
                class="form-select">
                <option value="">Select content type</option>
                @for (type of contentTypes; track type) {
                  <option [value]="type">{{ getContentTypeIcon(type) }} {{ type | titlecase }}</option>
                }
              </select>
              @if (resourceForm.get('type')?.invalid && resourceForm.get('type')?.touched) {
                <div class="form-error">Content type is required</div>
              }
            </div>

            <div class="form-group">
              <label for="url" class="form-label">Resource URL *</label>
              <input
                id="url"
                type="url"
                formControlName="url"
                class="form-input"
                placeholder="https://example.com/resource">
              @if (resourceForm.get('url')?.invalid && resourceForm.get('url')?.touched) {
                <div class="form-error">
                  @if (resourceForm.get('url')?.errors?.['required']) {
                    URL is required
                  }
                  @if (resourceForm.get('url')?.errors?.['pattern']) {
                    Please enter a valid URL starting with http:// or https://
                  }
                </div>
              }
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Description *</label>
            <textarea
              formControlName="description"
              class="form-textarea"
              rows="3"
              placeholder="Describe the resource and what navigators will learn..."></textarea>
            @if (resourceForm.get('description')?.invalid && resourceForm.get('description')?.touched) {
              <div class="form-error">
                @if (resourceForm.get('description')?.errors?.['required']) {
                  Description is required
                }
                @if (resourceForm.get('description')?.errors?.['minlength']) {
                  Description must be at least 10 characters long
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label class="form-label">Expertise Levels *</label>
            <div class="checkbox-group">
              @for (level of expertiseLevels; track level) {
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    [checked]="isExpertiseLevelSelected(level)"
                    (change)="onExpertiseLevelChange(level, $any($event.target).checked)"
                    class="checkbox-input">
                  <span class="checkbox-label">{{ level }} Navigator</span>
                </label>
              }
            </div>
            @if (expertiseLevelControls.invalid && expertiseLevelControls.touched) {
              <div class="form-error">At least one expertise level must be selected</div>
            }
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="duration" class="form-label">Duration</label>
              <input
                id="duration"
                type="text"
                formControlName="duration"
                class="form-input"
                placeholder="e.g., 10 minutes, 2 hours">
            </div>

            <div class="form-group">
              <label for="author" class="form-label">Author</label>
              <input
                id="author"
                type="text"
                formControlName="author"
                class="form-input"
                placeholder="Resource author/creator">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="source" class="form-label">Source</label>
              <input
                id="source"
                type="text"
                formControlName="source"
                class="form-input"
                placeholder="e.g., Google Developers, Medium, YouTube">
            </div>

            <div class="form-group">
              <label for="tags" class="form-label">Tags</label>
              <input
                id="tags"
                type="text"
                formControlName="tags"
                class="form-input"
                placeholder="Comma-separated tags (e.g., firebase, authentication, backend)">
            </div>
          </div>

          <div class="form-group">
            <label class="checkbox-item featured-checkbox">
              <input
                type="checkbox"
                formControlName="featured"
                class="checkbox-input">
              <span class="checkbox-label">‚≠ê Mark as Featured Resource</span>
            </label>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn-secondary"
              (click)="toggleForm()">
              Cancel
            </button>
            <button
              type="submit"
              class="btn-primary"
              [disabled]="loading() || resourceForm.invalid">
              @if (loading()) {
                <span class="loading-spinner"></span> Processing...
              } @else if (editingResource()) {
                ‚úÖ Update Resource
              } @else {
                üì§ Upload Resource
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- Track Overview -->
  @if (!showForm()) {
    <div class="tracks-overview">
      <div class="section-header">
        <h2 class="section-title">üìä Track Resource Overview</h2>
        <p class="section-subtitle">Click on a track to view and manage its resources</p>
      </div>

      @if (loading() && !selectedTrack()) {
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <span>Loading track data...</span>
        </div>
      }

      <div class="track-cards">
        @for (trackData of trackCounts(); track trackData.track) {
          <div
            class="track-card"
            [class.active]="selectedTrack() === trackData.track"
            (click)="loadResourcesForTrack(trackData.track)">
            <div class="track-header">
              <span class="track-icon">{{ getTrackIcon(trackData.track) }}</span>
              <h3 class="track-name">{{ trackData.track }}</h3>
            </div>
            <div class="track-stats">
              <span class="resource-count">{{ trackData.count }} resources</span>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Resource List -->
    @if (selectedTrack()) {
      <div class="resources-section">
        <div class="section-header">
          <h2 class="section-title">
            {{ getTrackIcon(selectedTrack()!) }} {{ selectedTrack() }} Resources
          </h2>
          <span class="resource-count">{{ resources().length }} resources</span>
        </div>

        @if (loading()) {
          <div class="loading-container">
            <div class="loading-spinner"></div>
            <span>Loading resources...</span>
          </div>
        } @else if (resources().length === 0) {
          <div class="empty-state">
            <div class="empty-icon">üìö</div>
            <h3 class="empty-title">No Resources Yet</h3>
            <p class="empty-description">
              Start by uploading the first resource for {{ selectedTrack() }}
            </p>
            <button class="btn-primary" (click)="toggleForm()">
              üì§ Upload First Resource
            </button>
          </div>
        } @else {
          <div class="admin-table-section">
            <div class="admin-table-container">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Resource</th>
                    <th>Type</th>
                    <th>Expertise</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  @for (resource of resources(); track resource.id) {
                    <tr>
                      <td>
                        <div class="resource-info">
                          <h4 class="resource-title">{{ resource.title }}</h4>
                          <p class="resource-description">{{ resource.description }}</p>
                          @if (resource.author) {
                            <span class="resource-author">by {{ resource.author }}</span>
                          }
                        </div>
                      </td>
                      <td>
                        <div class="content-type-badge">
                          {{ getContentTypeIcon(resource.type) }} {{ resource.type | titlecase }}
                        </div>
                      </td>
                      <td>
                        <div class="expertise-badges">
                          @for (level of resource.expertiseLevel; track level) {
                            <span class="expertise-badge">{{ level }}</span>
                          }
                        </div>
                      </td>
                      <td>
                        @if (resource.featured) {
                          <span class="status-badge featured">‚≠ê Featured</span>
                        } @else {
                          <span class="status-badge standard">üìã Standard</span>
                        }
                      </td>
                      <td>
                        <span class="date">{{ resource.createdAt | date:'MMM d, y' }}</span>
                      </td>
                      <td>
                        <div class="action-buttons">
                          <button
                            class="btn-icon btn-edit"
                            (click)="editResource(resource)"
                            title="Edit resource">
                            ‚úèÔ∏è
                          </button>
                          <button
                            class="btn-icon btn-delete"
                            (click)="deleteResource(resource)"
                            title="Delete resource">
                            üóëÔ∏è
                          </button>
                          <a
                            [href]="resource.url"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="btn-icon btn-external"
                            title="Open resource">
                            üîó
                          </a>
                        </div>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        }
      </div>
    }
  }
</div>
