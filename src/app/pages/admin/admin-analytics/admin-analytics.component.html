<div class="fleet-analytics-dashboard">
  <!-- Analytics Header -->
  <div class="analytics-header mb-4">
    <div class="header-content">
      <h1 class="analytics-title ocean-gradient-text"><span class="emoji">üìä</span> Fleet Analytics</h1>
      <p class="analytics-subtitle">Deep insights into your DevFest Dhow fleet performance</p>
      <div class="header-actions">
        <button
          class="btn btn-secondary refresh-btn"
          (click)="refreshAnalytics()"
          [disabled]="loading()"
        >
          <span class="btn-icon">üîÑ</span>
          {{ loading() ? 'Updating...' : 'Refresh Data' }}
        </button>
        <button
          class="btn btn-primary export-btn"
          (click)="exportAnalytics()"
        >
          <span class="btn-icon">üìÅ</span>
          Export Analytics
        </button>
      </div>
    </div>
    <div class="last-updated">
      Last updated: {{ formatTimestamp(lastUpdated()) }}
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <div class="loading-spinner ocean-blue"></div>
      <p class="loading-text">Analyzing fleet data...</p>
    </div>
  }

  <!-- Analytics Content -->
  @if (!loading()) {
    <!-- Overview Statistics -->
    <div class="overview-section">
      <h2 class="section-title">üåä Fleet Overview</h2>
      <div class="stats-grid">
        <div class="stat-card ocean-blue">
          <div class="stat-icon">üö¢</div>
          <div class="stat-content">
            <div class="stat-value">{{ fleetAnalytics().totalVoyages }}</div>
            <div class="stat-label">Total Voyages</div>
            <div class="stat-trend positive">
              {{ fleetAnalytics().activeVoyages }} active
            </div>
          </div>
        </div>

        <div class="stat-card wave-teal">
          <div class="stat-icon">üèùÔ∏è</div>
          <div class="stat-content">
            <div class="stat-value">{{ fleetAnalytics().totalIslands }}</div>
            <div class="stat-label">Total Islands</div>
            <div class="stat-trend">
              {{ averageIslandsPerVoyage() }} avg per voyage
            </div>
          </div>
        </div>

        <div class="stat-card coral-orange">
          <div class="stat-icon">üß≠</div>
          <div class="stat-content">
            <div class="stat-value">{{ fleetAnalytics().totalNavigators }}</div>
            <div class="stat-label">Fleet Navigators</div>
            <div class="stat-trend positive">
              <span class="trend-icon">üìà</span> Growing
            </div>
          </div>
        </div>

        <div class="stat-card magenta-violet">
          <div class="stat-icon">‚ö°</div>
          <div class="stat-content">
            <div class="stat-value">{{ voyageCompletionRate() }}%</div>
            <div class="stat-label">Completion Rate</div>
            <div class="stat-trend">
              {{ fleetAnalytics().completedVoyages }} / {{ fleetAnalytics().totalVoyages }} voyages
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Analytics Grid -->
    <div class="analytics-grid">
      <!-- Voyage Distribution Chart -->
      <div class="analytics-card">
        <div class="card-header">
          <h3 class="card-title">üó∫Ô∏è Voyage Status Distribution</h3>
        </div>
        <div class="card-content">
          @if (Object.keys(fleetAnalytics().voyagesByStatus).length > 0) {
            <div class="distribution-chart">
              @for (status of Object.keys(fleetAnalytics().voyagesByStatus); track status) {
                <div class="distribution-item">
                  <div class="distribution-bar">
                    <div
                      class="bar-fill"
                      [class]="'status-' + status"
                      [style.width.%]="(fleetAnalytics().voyagesByStatus[status] / fleetAnalytics().totalVoyages) * 100"
                    ></div>
                  </div>
                  <div class="distribution-label">
                    <span class="status-name">{{ status | titlecase }}</span>
                    <span class="status-count">{{ fleetAnalytics().voyagesByStatus[status] }}</span>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <p>No voyage data available</p>
            </div>
          }
        </div>
      </div>

      <!-- Navigator Roles Chart -->
      <div class="analytics-card">
        <div class="card-header">
          <h3 class="card-title">üë• Navigator Role Distribution</h3>
        </div>
        <div class="card-content">
          @if (Object.keys(fleetAnalytics().navigatorsByRole).length > 0) {
            <div class="role-distribution">
              @for (role of Object.keys(fleetAnalytics().navigatorsByRole); track role) {
                <div class="role-item">
                  <div class="role-info">
                    <span class="role-name">{{ role | titlecase }}</span>
                    <span class="role-count">{{ fleetAnalytics().navigatorsByRole[role] }}</span>
                  </div>
                  <div class="role-bar">
                    <div
                      class="bar-fill"
                      [class]="'role-' + role"
                      [style.width.%]="(fleetAnalytics().navigatorsByRole[role] / fleetAnalytics().totalNavigators) * 100"
                    ></div>
                  </div>
                  <div class="role-percentage">
                    {{ Math.round((fleetAnalytics().navigatorsByRole[role] / fleetAnalytics().totalNavigators) * 100) }}%
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <p>No navigator data available</p>
            </div>
          }
        </div>
      </div>

      <!-- Islands per Voyage -->
      <div class="analytics-card full-width">
        <div class="card-header">
          <h3 class="card-title">üèùÔ∏è Islands Distribution by Voyage</h3>
        </div>
        <div class="card-content">
          @if (fleetAnalytics().islandsByVoyage.length > 0) {
            <div class="islands-chart">
              @for (voyage of fleetAnalytics().islandsByVoyage; track voyage.voyageName) {
                <div class="voyage-bar">
                  <div class="voyage-info">
                    <span class="voyage-name">{{ voyage.voyageName }}</span>
                    <span class="island-count">{{ voyage.islandCount }} islands</span>
                  </div>
                  <div class="voyage-progress">
                    <div
                      class="progress-fill"
                      [style.width.%]="voyage.islandCount > 0 ? (voyage.islandCount / getMaxIslandCount()) * 100 : 0"
                    ></div>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <p>No voyage data available</p>
            </div>
          }
        </div>
      </div>

      <!-- Recent Activity Feed -->
      <div class="analytics-card">
        <div class="card-header">
          <h3 class="card-title">üìã Recent Fleet Activity</h3>
        </div>
        <div class="card-content">
          @if (fleetAnalytics().recentActivity.length > 0) {
            <div class="activity-feed">
              @for (activity of fleetAnalytics().recentActivity; track activity.id) {
                <div class="activity-item" [class]="'activity-' + activity.type">
                  <div class="activity-indicator"></div>
                  <div class="activity-content">
                    <div class="activity-header">
                      <span class="activity-action">{{ activity.action }}</span>
                      <span class="activity-timestamp">{{ formatTimestamp(activity.timestamp) }}</span>
                    </div>
                    <p class="activity-details">{{ activity.details }}</p>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <p>No recent activity</p>
            </div>
          }
        </div>
      </div>

      <!-- Quick Insights -->
      <div class="analytics-card">
        <div class="card-header">
          <h3 class="card-title">üí° Quick Insights</h3>
        </div>
        <div class="card-content">
          <div class="insights-list">
            <div class="insight-item positive">
              <div class="insight-icon">üìà</div>
              <div class="insight-text">
                Fleet has {{ fleetAnalytics().totalVoyages }} active voyages with
                {{ fleetAnalytics().totalIslands }} scheduled islands
              </div>
            </div>

            <div class="insight-item">
              <div class="insight-icon">‚öì</div>
              <div class="insight-text">
                Average of {{ averageIslandsPerVoyage() }} islands per voyage
                ensures comprehensive coverage
              </div>
            </div>

            <div class="insight-item">
              <div class="insight-icon">üß≠</div>
              <div class="insight-text">
                {{ fleetAnalytics().totalNavigators }} navigators registered
                for the DevFest journey
              </div>
            </div>

            @if (voyageCompletionRate() > 70) {
              <div class="insight-item positive">
                <div class="insight-icon">üåü</div>
                <div class="insight-text">
                  Excellent completion rate of {{ voyageCompletionRate() }}%
                  shows strong fleet performance
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Analytics Footer -->
    <div class="analytics-footer">
      <div class="footer-info">
        <p class="analytics-note">
          Analytics are updated in real-time and refreshed every 5 minutes automatically.
          Export data for detailed analysis and reporting.
        </p>
      </div>
    </div>
  }
</div>
