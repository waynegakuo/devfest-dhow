<div class="admin-voyage-management">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">üö¢ Fleet Management</h1>
      <p class="page-subtitle">Manage voyage groups that organize sessions by time or theme</p>
    </div>
    <button class="btn-primary create-btn" (click)="createVoyage()" [disabled]="loading()">
      <span class="btn-icon">+</span>
      Create New Voyage Group
    </button>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading voyages...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <div class="error-message">
        <span class="error-icon">‚ö†Ô∏è</span>
        {{ error() }}
      </div>
      <button class="btn-secondary" (click)="loadVoyages()">Retry</button>
    </div>
  }

  <!-- Voyages Table -->
  <div class="admin-table-section">
    <div class="table-container">
      <table class="admin-table voyages-table">
        <thead>
          <tr>
            <th>Voyage Group</th>
            <th>Date</th>
            <th>Sessions</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (voyage of voyages(); track voyage.id) {
            <tr class="voyage-row">
              <td class="voyage-name">
                <h4>{{ voyage.name }}</h4>
              </td>
              <td class="voyage-date">{{ formatDate(voyage.date) }}</td>
              <td class="voyage-sessions">
                <span class="sessions-count">{{ voyage.islands.length }} sessions</span>
              </td>
              <td class="voyage-actions">
                <div class="action-buttons">
                  <button class="btn-info btn-sm" (click)="manageIslands(voyage)" title="Manage Islands">
                    üèùÔ∏è
                  </button>
                  <button class="btn-secondary btn-sm" (click)="editVoyage(voyage)" title="Edit Voyage">
                    ‚úèÔ∏è
                  </button>
                  <button class="btn-danger btn-sm" (click)="deleteVoyage(voyage.id)" title="Delete Voyage">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          }
          @empty {
            <tr>
              <td colspan="4" class="empty-state">
                <div class="empty-content">
                  <div class="empty-icon">üö¢</div>
                  <h3>No Voyage Groups Found</h3>
                  <p>Create your first voyage group to organize sessions by time or theme.</p>
                  <button class="btn-primary" (click)="createVoyage()">Create Voyage Group</button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Islands Management Section -->
  @if (selectedVoyageForIslands()) {
    <div class="admin-table-section islands-management-section">
      <div class="islands-header">
        <div class="islands-title">
          <h2>üèùÔ∏è Islands Management - {{ selectedVoyageForIslands()?.name }}</h2>
          <p>Manage sessions (islands) for this voyage</p>
        </div>
        <div class="islands-actions">
          <button class="btn-primary" (click)="createIsland()" [disabled]="loading()">
            <span class="btn-icon">+</span>
            Add Island
          </button>
          <button class="btn-secondary" (click)="closeIslandsManagement()">
            Close
          </button>
        </div>
      </div>

      <!-- Islands Table -->
      <div class="islands-table-container">
        <table class="admin-table islands-table">
          <thead>
            <tr>
              <th>Title</th>
              <th>Speaker</th>
              <th>Time</th>
              <th>Venue</th>
              <th>Type</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (island of voyageIslands(); track island.id) {
              <tr class="island-row">
                <td class="island-title">{{ island.title }}</td>
                <td class="island-speaker">
                  <div class="speaker-info">
                    <div class="speaker-name">{{ island.speaker }}</div>
                    <div class="speaker-details">{{ island.speakerRole }} - {{ island.speakerCompany }}</div>
                  </div>
                </td>
                <td class="island-time">{{ island.time }} ({{ island.duration }})</td>
                <td class="island-venue">{{ island.venue }}</td>
                <td class="island-type">{{ island.sessionType }}</td>
                <td class="island-actions">
                  <div class="action-buttons">
                    <button class="btn-secondary btn-sm" (click)="editIsland(island)" title="Edit Island">
                      ‚úèÔ∏è
                    </button>
                    <button class="btn-danger btn-sm" (click)="deleteIsland(island)" title="Delete Island">
                      üóëÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
            }
            @empty {
              <tr>
                <td colspan="6" class="empty-state">
                  <div class="empty-content">
                    <div class="empty-icon">üèùÔ∏è</div>
                    <h3>No Islands Found</h3>
                    <p>Add islands (sessions) to this voyage.</p>
                    <button class="btn-primary" (click)="createIsland()">Add First Island</button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }

  <!-- Create Voyage Modal -->
  @if (showCreateModal()) {
    <div class="modal-overlay" (click)="cancelVoyageModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Create New Voyage Group</h2>
          <button class="modal-close" (click)="cancelVoyageModal()">&times;</button>
        </div>

        <div class="modal-body">
          <form class="voyage-form">
            <div class="form-group">
              <label for="voyageName">Voyage Group Name</label>
              <input
                type="text"
                id="voyageName"
                name="voyageName"
                class="form-control"
                [(ngModel)]="voyageForm().name"
                placeholder="e.g., Opening Waters - Morning Keynotes"
                required>
            </div>

            <div class="form-group">
              <label for="voyageDate">Date</label>
              <input
                type="date"
                id="voyageDate"
                name="voyageDate"
                class="form-control"
                [(ngModel)]="voyageForm().date"
                required>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn-secondary" (click)="cancelVoyageModal()" [disabled]="loading()">Cancel</button>
          <button class="btn-primary" (click)="saveVoyage()" [disabled]="loading()">
            @if (loading()) {
              <span class="loading-spinner-small"></span>
            }
            Create Voyage Group
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Edit Voyage Modal -->
  @if (showEditModal()) {
    <div class="modal-overlay" (click)="cancelVoyageModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Edit Voyage Group</h2>
          <button class="modal-close" (click)="cancelVoyageModal()">&times;</button>
        </div>

        <div class="modal-body">
          <form class="voyage-form">
            <div class="form-group">
              <label for="editVoyageName">Voyage Group Name</label>
              <input
                type="text"
                id="editVoyageName"
                name="editVoyageName"
                class="form-control"
                [(ngModel)]="voyageForm().name"
                placeholder="e.g., Opening Waters - Morning Keynotes"
                required>
            </div>

            <div class="form-group">
              <label for="editVoyageDate">Date</label>
              <input
                type="date"
                id="editVoyageDate"
                name="editVoyageDate"
                class="form-control"
                [(ngModel)]="voyageForm().date"
                required>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn-secondary" (click)="cancelVoyageModal()" [disabled]="loading()">Cancel</button>
          <button class="btn-primary" (click)="saveVoyage()" [disabled]="loading()">
            @if (loading()) {
              <span class="loading-spinner-small"></span>
            }
            Update Voyage Group
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Create Island Modal -->
  @if (showCreateIslandModal()) {
    <div class="modal-overlay" (click)="cancelIslandModal()">
      <div class="modal-content large-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Create New Island</h2>
          <button class="modal-close" (click)="cancelIslandModal()">&times;</button>
        </div>

        <div class="modal-body">
          <form class="island-form">
            <div class="form-row">
              <div class="form-group">
                <label for="islandTitle">Session Title *</label>
                <input
                  type="text"
                  id="islandTitle"
                  name="islandTitle"
                  class="form-control"
                  [(ngModel)]="islandForm().title"
                  placeholder="e.g., AI-Powered Navigation"
                  required>
              </div>

              <div class="form-group">
                <label for="islandTime">Time *</label>
                <input
                  type="time"
                  id="islandTime"
                  name="islandTime"
                  class="form-control"
                  [(ngModel)]="islandForm().time"
                  required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="islandSpeaker">Speaker *</label>
                <input
                  type="text"
                  id="islandSpeaker"
                  name="islandSpeaker"
                  class="form-control"
                  [(ngModel)]="islandForm().speaker"
                  placeholder="Speaker name"
                  required>
              </div>

              <div class="form-group">
                <label for="islandDuration">Duration</label>
                <input
                  type="text"
                  id="islandDuration"
                  name="islandDuration"
                  class="form-control"
                  [(ngModel)]="islandForm().duration"
                  placeholder="e.g., 40 min">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="islandRole">Speaker Role</label>
                <input
                  type="text"
                  id="islandRole"
                  name="islandRole"
                  class="form-control"
                  [(ngModel)]="islandForm().speakerRole"
                  placeholder="e.g., Senior Developer">
              </div>

              <div class="form-group">
                <label for="islandCompany">Company</label>
                <input
                  type="text"
                  id="islandCompany"
                  name="islandCompany"
                  class="form-control"
                  [(ngModel)]="islandForm().speakerCompany"
                  placeholder="e.g., Google">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="islandVenue">Venue</label>
                <select
                  id="islandVenue"
                  name="islandVenue"
                  class="form-control"
                  [(ngModel)]="islandForm().venue">
                  @for (deck of deckOptions; track deck) {
                    <option [value]="deck">{{ deck }}</option>
                  }
                </select>
              </div>

              <div class="form-group">
                <label for="islandType">Session Type</label>
                <select
                  id="islandType"
                  name="islandType"
                  class="form-control"
                  [(ngModel)]="islandForm().sessionType">
                  @for (type of sessionTypeOptions; track type) {
                    <option [value]="type">{{ type }}</option>
                  }
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="islandDescription">Description</label>
              <textarea
                id="islandDescription"
                name="islandDescription"
                class="form-control"
                rows="3"
                [(ngModel)]="islandForm().description"
                placeholder="Session description..."></textarea>
            </div>

            <div class="form-group">
              <label for="islandTags">Tags</label>
              <div class="tags-input-container">
                <div class="tags-list">
                  @for (tag of islandForm().tags; track tag) {
                    <span class="tag">
                      {{ tag }}
                      <button type="button" class="tag-remove" (click)="removeTag(tag)">√ó</button>
                    </span>
                  }
                </div>
                <input
                  type="text"
                  name="tagInput"
                  class="form-control"
                  placeholder="Add tag and press Enter"
                  (keydown)="addTag($event)">
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn-secondary" (click)="cancelIslandModal()" [disabled]="loading()">Cancel</button>
          <button class="btn-primary" (click)="saveIsland()" [disabled]="loading()">
            @if (loading()) {
              <span class="loading-spinner-small"></span>
            }
            Create Island
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Edit Island Modal -->
  @if (showEditIslandModal()) {
    <div class="modal-overlay" (click)="cancelIslandModal()">
      <div class="modal-content large-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Edit Island</h2>
          <button class="modal-close" (click)="cancelIslandModal()">&times;</button>
        </div>

        <div class="modal-body">
          <form class="island-form">
            <div class="form-row">
              <div class="form-group">
                <label for="editIslandTitle">Session Title *</label>
                <input
                  type="text"
                  id="editIslandTitle"
                  name="editIslandTitle"
                  class="form-control"
                  [(ngModel)]="islandForm().title"
                  placeholder="e.g., AI-Powered Navigation"
                  required>
              </div>

              <div class="form-group">
                <label for="editIslandTime">Time *</label>
                <input
                  type="time"
                  id="editIslandTime"
                  name="editIslandTime"
                  class="form-control"
                  [(ngModel)]="islandForm().time"
                  required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="editIslandSpeaker">Speaker *</label>
                <input
                  type="text"
                  id="editIslandSpeaker"
                  name="editIslandSpeaker"
                  class="form-control"
                  [(ngModel)]="islandForm().speaker"
                  placeholder="Speaker name"
                  required>
              </div>

              <div class="form-group">
                <label for="editIslandDuration">Duration</label>
                <input
                  type="text"
                  id="editIslandDuration"
                  name="editIslandDuration"
                  class="form-control"
                  [(ngModel)]="islandForm().duration"
                  placeholder="e.g., 40 min">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="editIslandRole">Speaker Role</label>
                <input
                  type="text"
                  id="editIslandRole"
                  name="editIslandRole"
                  class="form-control"
                  [(ngModel)]="islandForm().speakerRole"
                  placeholder="e.g., Senior Developer">
              </div>

              <div class="form-group">
                <label for="editIslandCompany">Company</label>
                <input
                  type="text"
                  id="editIslandCompany"
                  name="editIslandCompany"
                  class="form-control"
                  [(ngModel)]="islandForm().speakerCompany"
                  placeholder="e.g., Google">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="editIslandVenue">Venue</label>
                <select
                  id="editIslandVenue"
                  name="editIslandVenue"
                  class="form-control"
                  [(ngModel)]="islandForm().venue">
                  @for (deck of deckOptions; track deck) {
                    <option [value]="deck">{{ deck }}</option>
                  }
                </select>
              </div>

              <div class="form-group">
                <label for="editIslandType">Session Type</label>
                <select
                  id="editIslandType"
                  name="editIslandType"
                  class="form-control"
                  [(ngModel)]="islandForm().sessionType">
                  @for (type of sessionTypeOptions; track type) {
                    <option [value]="type">{{ type }}</option>
                  }
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="editIslandDescription">Description</label>
              <textarea
                id="editIslandDescription"
                name="editIslandDescription"
                class="form-control"
                rows="3"
                [(ngModel)]="islandForm().description"
                placeholder="Session description..."></textarea>
            </div>

            <div class="form-group">
              <label for="editIslandTags">Tags</label>
              <div class="tags-input-container">
                <div class="tags-list">
                  @for (tag of islandForm().tags; track tag) {
                    <span class="tag">
                      {{ tag }}
                      <button type="button" class="tag-remove" (click)="removeTag(tag)">√ó</button>
                    </span>
                  }
                </div>
                <input
                  type="text"
                  name="editTagInput"
                  class="form-control"
                  placeholder="Add tag and press Enter"
                  (keydown)="addTag($event)">
              </div>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="editIslandAttended"
                  [(ngModel)]="islandForm().attended">
                Mark as attended
              </label>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn-secondary" (click)="cancelIslandModal()" [disabled]="loading()">Cancel</button>
          <button class="btn-primary" (click)="saveIsland()" [disabled]="loading()">
            @if (loading()) {
              <span class="loading-spinner-small"></span>
            }
            Update Island
          </button>
        </div>
      </div>
    </div>
  }

</div>
